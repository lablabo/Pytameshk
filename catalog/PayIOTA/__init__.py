from __future__ import absolute_import, division, print_function, unicode_literals
import zmq
from zmq.utils.monitor import recv_monitor_message
from iota import TryteString


class controller:
    def __init__(self, action, libraries, INIFile):
        iota = libraries['iota']
        #iota.encode_tryte('Mohammad')
        #iota.decode_tryte2(b'ODGASCPCHDPCGADBGASCYBRB9C9DBDGCSBQCPBFDMDBCXCNBSCDCWAICADRCCCXBUBGCYACDVAWALBLDHDXACCYBXADCECHCDCEDNDRBFCWCNBNCBCZBBCSCYAGDQCLBECGCGCHDWCUCZBADHDSBMDBCTBJDYAPCRCMDMDSCZBGCKBPCPBCCACGDUCVAGDYBPBRCNDADJDIDRADDYCMDSBDC9BABHDEDYCLBEDXCVBGDGDUBUCCCEDUBCDUBTBXAWCCCMDACUCPCCCKBCCZAMDHDMBRCTCXBCCJDHDLBMBWCXADDUBUCCCVCBCRCMBLBYCADNBCDXCNCZAYBSCCBMBVCMDRBEDBBWAXBOBBCZANDPCMBHCNBVATBWA9DTBRCRAKBUCVACBSBRASBPBCBZCQBMBQCRCYAHCADMBFDBCVCDDFDZCQCCBKDRCTCNDLDXBCBWCGDDCLDSCRBYA9CSCKBPCCDBDWBXAGD9DDDGDRAACYBVAHCBDUAZCRBOBCCTCRASCHCRAOBGCQCIDCDSC9BRAWA9DACBBYBRBUAYAICTBDDDCFCNBYCHCBCICQBICYARAEDUBICRBLBOBUCRBSCSBTBRBVAUBKD9BGCMDCBHDDCWAVC9BUCCDXBCBTCNBCCBCYCYAABWCECPBICDDSBSBFDRBSBWCMBICRBABVAMDACVCRBICUBED9BNCZCABVCUAIDZBMBQBHCCDCCLBKBBBSCPBICSBECBDMDMBRA9DICLDIDBCTBUANBSBADECICYCGDVBCBXCADPBBCPBQBIDVAYCJDLBGCCCLBYAJDWBEC9BTCFCGCIDABBDTCADUBNDNCYBQBWAMDFDWCOBDCFCGDBBXAHDPCWBUAQBPBZBBCQBNCUBKBWCXCBBRCVBSCFDZAPCRBPCCDJDYCTCICQCZBNDTCIDGDYA9CYA9CUBID9BHDJDTCADRBTB9BADRBRCVAYCHD9BVBNCADBBRCWAABYARBXAYCHCBDPCZAGDNCCBTBACBB9CECBDACQCZCEDBBYBWAHCNBCDVAACRBXCTCMDLD9BZAMBCCWAVBMBAC9BQCWBUAYBYCMBXAGCPBID9DSBTBHCGDADDCACLD9BCDRBZAXBECVANBOBWC9DWB9BPBYAEDIDFCBDBDCBYBQB9DYAEDCDFCNDZBRBJDWCCCHCHCPCWASCTBZCUASBADMBRCUBSCFCSBSBPCKBTBICRCJDPDYCSBMDNCSBBCZCXBBCPCJDFD9DTCICICDCHCVAABXCACKDIDBBGCQCTBHD9DNCTCPCHCWCPBNBID9BNDACUBXAWCXAPCKBVANBUAVBTBJDPCBBBBVALB9CNBABADVBSBQCWC9CPCCBYCSBWBSBYCABUCQBICDCICPBYCTBYBCDLDQCGCWARCWBRBGDFDJDRCICWBCDMDMBMBNBXCXBVCLDZBGCNBADPBZBRCLBECMDPCQBGDXABBXBZAXCECWCNBCDMDHDCCSBNDHD9DPBYBKBVCJDYCWB9BYBYCWBSCPCUAXBYAFDLDVAOBZBVCUARBZCWAMDQBBBRCFDABZBCDYBWBRCHCWCECCCFDXATBQCMDICACVCKBNDTCZC9DACQBWCRAECHCBBWCLDRAMDZCKBTCKBABCCSCLDCBCCQCRBDCHCEDZAACUBLDXBOBECBDCBKBOBHCFDYAUBFDYCHCTBTCOBACYCZCWBHDWCNCVAABUBHCIDQCPCXCZA9BVANDRBWAJDXCVABBNBVBPCNBUBQCDDLDRCUACCPBKDYCRBEDABDDHDTBQBUAPCABOBABJDFCLDCD9CZCACUBDCECLBOBWBCCWCACHCVBYCWCECJDUCIDQBHCUCBBXBOBLDCDQCQBTBOBEDUADDICABACPCGCZABDZCRAVAZAACUCCDKDGBGBGAQAGABDLDHDGADBGAGAQDEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEAEA9O9OYTKPHBKOJJGQWCOOVJZTDR9LQJJKLQZQOETDOFSFOKAFKEBKSQEALZLWXPUFNHWFCGNHO9FVUWMZUZ999999999999999999999999999HOODSID99999999999999999999XHJPRAD99999999999999999999QCDHPWYGDEUFXBNHHZB9TEJLYHDXKH9LFXUOCRGNW9PLRHVJFNQATJAZVGLSEG9LSNCCAXJRBWTTLZNB9TQEIFQWQWHDYKGVOHGEONMZARBRWBKPLDZOJMHELP9VZLHATQNUZNJXFASCGRBKNXPAEKOVPMPHHZ9999TQEIFQWQWHDYKGVOHGEONMZARBRWBKPLDZOJMHELP9VZLHATQNUZNJXFASCGRBKNXPAEKOVPMPHHZ9999GOODSID99999999999999999999XLISCDANF999999999MMMMMMMMMQXOXTWYCPEDUPKPIWHOJGLDJ9DY')
        #iota.prepare_transaction()
        iota.do_broadcastTransactions()
        #self.testZMG(iota)

    def testZMG(self, iota):
        context = zmq.Context()
        socket = zmq.Socket(context, zmq.SUB)
        monitor = socket.get_monitor_socket()

        #tcp://iota.av.it.pt:5555
        socket.connect("tcp://iota.av.it.pt:5555")
        while True:
            status = recv_monitor_message(monitor)
            if status['event'] == zmq.EVENT_CONNECTED:
                break
            elif status['event'] == zmq.EVENT_CONNECT_DELAYED:
                pass

        print('connected')
        socket.subscribe('tx_trytes')
        while True:
            topic = socket.recv_string()
            topic = topic.split(" ")
            print(topic)
            data = iota.decode_tryte_method_2(topic[1].encode('utf-8'))
            #data = iota.decode_tryte_method_2(b'ODLADDFDTCGDXCSCTCBDHDLADBEAODLABDPCADTCLADBEALAICPCDDWCCDSCEALBTCTCQC9DTCQCFDCDLDLAQAEALAGDDDTCRCXCTCGDLADBEALALBTCHDTC9DVCTCIDGDXCPCBDLAQDQD99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999ADDRESS9GOES9HERE99999999999999999999999999999999999TESTVALUE9DONTUSEINPRODUCTION999999999999999999999999999YPMLO9WORLD9999999999999999KLWQRAD99999999999999999999KIRDPYDH9IUZBQENEGJBQVVCYSFNGYAFNQTQGDJKYCLVQLHZR9GVEZYNZLTIFOZWKT9XB9JRGLWUJUWQZ999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999HELLO9WORLD9999999999999999999999999999999999999999999999999999999999999999999999')
            # More Information https://pyota.readthedocs.io/en/latest/types.html
            print(data)
